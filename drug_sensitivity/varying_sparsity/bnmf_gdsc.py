"""
Test the performance of BNMF for recovering the GDSC dataset, where we vary the 
fraction of entries that are missing.
We repeat this 10 times per fraction and average that.
"""

import sys, os
project_location = os.path.dirname(__file__)+"/../../../"
sys.path.append(project_location)

from HMF.code.models.bnmf_gibbs import bnmf_gibbs
from HMF.code.generate_mask.mask import try_generate_M_from_M
from HMF.drug_sensitivity.load_dataset import load_data_without_empty

import numpy, matplotlib.pyplot as plt, random

''' Settings '''
fractions_unknown = [0.3, 0.35, 0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75, 0.8, 0.85, 0.9]
repeats = 20
iterations, burn_in, thinning = 1000, 900, 2

init_UV = 'random'
K = 4

alpha, beta = 1., 1.
lambdaU = 1.
lambdaV = 1.
priors = { 'alpha':alpha, 'beta':beta, 'lambdaU':lambdaU, 'lambdaV':lambdaV }

metrics = ['MSE', 'R^2', 'Rp']

''' Load data '''
location = project_location+"DI_MMTF/data/datasets_drug_sensitivity/overlap/"
location_data = location+"data_row_01/"
R, M_original, _, _ = load_data_without_empty(location_data+"gdsc_ic50_row_01.txt")

#''' Seed all of the methods the same '''
#numpy.random.seed(0)
#random.seed(0)

''' Generate matrices M - one list of (M_train,M_test)'s for each fraction '''
M_attempts = 1000
all_Ms_train_test = [ 
    [try_generate_M_from_M(M=M_original,fraction=fraction,attempts=M_attempts) for r in range(0,repeats)]
    for fraction in fractions_unknown
]

''' Make sure each M has no empty rows or columns '''
def check_empty_rows_columns(M,fraction):
    sums_columns = M.sum(axis=0)
    sums_rows = M.sum(axis=1)
    for i,c in enumerate(sums_rows):
        assert c != 0, "Fully unobserved row in M, row %s. Fraction %s." % (i,fraction)
    for j,c in enumerate(sums_columns):
        assert c != 0, "Fully unobserved column in M, column %s. Fraction %s." % (j,fraction)
        
for Ms_train_test,fraction in zip(all_Ms_train_test,fractions_unknown):
    for (M_train,M_test) in Ms_train_test:
        check_empty_rows_columns(M_train,fraction)

''' Run the method on each of the M's for each fraction '''
all_performances = {metric:[] for metric in metrics} 
average_performances = {metric:[] for metric in metrics} # averaged over repeats
for (fraction,Ms_train_test) in zip(fractions_unknown,all_Ms_train_test):
    print "Trying fraction %s." % fraction
    
    # Run the algorithm <repeats> times and store all the performances
    for metric in metrics:
        all_performances[metric].append([])
    for repeat,(M_train,M_test) in zip(range(0,repeats),Ms_train_test):
        print "Repeat %s of fraction %s." % (repeat+1, fraction)
    
        BNMF = bnmf_gibbs(R,M_train,K,priors)
        BNMF.initialise(init_UV)
        BNMF.run(iterations)
    
        # Measure the performances
        performances = BNMF.predict(M_test,burn_in,thinning)
        for metric in metrics:
            # Add this metric's performance to the list of <repeat> performances for this fraction
            all_performances[metric][-1].append(performances[metric])
            
    # Compute the average across attempts
    for metric in metrics:
        average_performances[metric].append(sum(all_performances[metric][-1])/repeats)
    
 
print "repeats=%s \nfractions_unknown = %s \nall_performances = %s \naverage_performances = %s" % \
    (repeats,fractions_unknown,all_performances,average_performances)

'''
200 iterations
repeats=10 
fractions_unknown = [0.3, 0.35, 0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75, 0.8, 0.85, 0.9] 
all_performances = {'R^2': [[0.5846345522300793, 0.5942845369204632, 0.5967828084841125, 0.575695253016793, 0.544815805245646, 0.6198404010787207, 0.5756607200910788, 0.5554006218554062, 0.5968725914028101, 0.6177972382789085], [0.5848045488077691, 0.5528571632595023, 0.5791212963665022, 0.5832191421562236, 0.583993343354057, 0.5689999266090211, 0.5871910437005814, 0.6207451989438963, 0.5950782498168863, 0.6187414847726322], [0.5953312125837116, 0.5939134205718626, 0.5823924111133445, 0.6032876828049853, 0.5883807060448685, 0.5678237341118515, 0.5954472016308366, 0.57077148779742, 0.5901596061768271, 0.5503170086487094], [0.5648838074552875, 0.5833633437389492, 0.5754860322906525, 0.569870169026388, 0.5689639519895772, 0.57700720913542, 0.5523546378582265, 0.5649454371445362, 0.5823217661149727, 0.5813343998072851], [0.5791535127955474, 0.5587723098629243, 0.5514246094828226, 0.5765186685736767, 0.5658519543990794, 0.5549905823589746, 0.5645006240818444, 0.5769584649696412, 0.5985086556816717, 0.5773754986749559], [0.5704486714303144, 0.5665484630956028, 0.5518884579463543, 0.5671689104588351, 0.5680230128345231, 0.5651978275856776, 0.5539240299017227, 0.5540543414163626, 0.5597465571434659, 0.5629678489377115], [0.555812595652813, 0.5361015272889333, 0.562052743569791, 0.5346868192974649, 0.5508481980926457, 0.5431242969272196, 0.5618237326004156, 0.5514326555148268, 0.5306195645348329, 0.5506720422538041], [0.5276748350983613, 0.5416412852686505, 0.5363537643592209, 0.544598726698976, 0.5337493315875541, 0.5412648077252527, 0.5351989118763438, 0.5368353410029902, 0.5333529945704704, 0.5358146339158685], [0.5253806042705447, 0.5106966545691362, 0.5138607719592024, 0.5156148497105983, 0.5115145656961946, 0.513067334430612, 0.5096015186048631, 0.5356057678016655, 0.5226983654401478, 0.5294301943848521], [0.5103497314192051, 0.521498377234753, 0.5107484151968089, 0.4878350191601686, 0.502061174491781, 0.49310443997340014, 0.4947357919974972, 0.5035924525128428, 0.502164156821484, 0.5180257579408031], [0.4836674773477043, 0.45017660915627555, 0.48354408326392806, 0.4545770241509475, 0.4498748129668815, 0.48286147496938836, 0.47773527508332925, 0.456063643289931, 0.4622365291651098, 0.45502561128619134], [0.43968734830350564, 0.4243162689639731, 0.4318276162775032, 0.4508208048899912, 0.4215516035776887, 0.42918908440280157, 0.4199568628085425, 0.43392453902126593, 0.42111199358927864, 0.4440182816481033], [0.38335516212462817, 0.36213864310641763, 0.362736189461766, 0.40995498394197816, 0.3474867051109478, 0.36392903749187233, 0.36728373475700216, 0.4037044985496594, 0.40361886568035077, 0.3854475647439505]], 'MSE': [[0.081364981348119605, 0.078522116323120658, 0.080209148868228913, 0.084121837103334721, 0.090009299687818359, 0.078007565014955815, 0.084649955297776566, 0.088975926987693604, 0.08039609894165374, 0.074438665045198305], [0.082346570379071213, 0.089912361369804891, 0.084149746543125584, 0.083787146826903053, 0.083323948310340124, 0.085570085884178124, 0.08227642893830095, 0.075368132680844274, 0.081048517126663763, 0.075729809202614073], [0.080385129022992302, 0.082516784470227242, 0.083029373506517484, 0.07875045832554721, 0.082146816262046063, 0.087589312498961985, 0.080827306460122025, 0.085678841146367854, 0.081808937856939809, 0.088858999821109105], [0.087278930116607936, 0.08292627053580591, 0.083901465090280292, 0.086125263505348687, 0.085346529691370951, 0.084010813964591466, 0.08883060670758347, 0.086878846081613267, 0.082896157837946891, 0.083005955639420273], [0.084295817645639232, 0.088312891921503031, 0.08956186765557117, 0.08476496453803041, 0.086492077705349946, 0.088248897761123074, 0.086598136653238733, 0.084566539277739966, 0.079746429145574713, 0.084390533995412798], [0.085543606843626677, 0.086390243926929275, 0.089511681938478596, 0.086772143966176274, 0.086074051601854523, 0.087230057994447552, 0.088315468524597721, 0.089091795632983029, 0.087882437109603653, 0.08667794924923114], [0.08871454164542264, 0.092180941830780655, 0.087111916690036553, 0.092529581739133948, 0.089395762595519804, 0.091501380972042773, 0.087428437264423231, 0.08921739442237106, 0.093997163557297717, 0.089307379967819081], [0.094212982815813029, 0.091739514472933853, 0.092366177416828801, 0.091233957597764176, 0.09285806583390209, 0.091510797247703696, 0.092543777469299121, 0.092790014936696863, 0.093393572687923782, 0.092750184515271672], [0.09445498612493744, 0.098304982988951489, 0.096992789883146829, 0.096985512011493955, 0.097488056885255428, 0.097078077295639109, 0.097346924376941757, 0.092819519999972691, 0.095596950936268521, 0.093561121032465611], [0.09804106992087408, 0.095571050968612403, 0.097355052581156606, 0.1021609657584665, 0.099095277621566794, 0.10033583004854234, 0.10070913192735588, 0.099111400410233863, 0.09943950491597349, 0.095956166629022968], [0.10287884759412361, 0.10956609685643583, 0.10294888780218728, 0.10885098115578558, 0.10960805512113191, 0.10289235396429897, 0.1044097813048164, 0.10839176868708639, 0.10726578674018998, 0.10899584833837676], [0.11192214943398809, 0.11503487895464549, 0.1129759057437926, 0.1093841685093087, 0.1151456997337225, 0.11378414284598436, 0.11577606543740233, 0.1130243808798623, 0.11552054559473154, 0.11100808426430875], [0.12296158690757167, 0.1270295352081294, 0.12690838785745831, 0.11753035483865457, 0.13017913425278108, 0.12694289342867984, 0.12629991572740565, 0.11896182980942632, 0.11897509076280822, 0.12242902234515163]], 'Rp': [[0.76476437931452734, 0.77097947475549422, 0.77263661675526341, 0.75908460441375536, 0.7421714401152234, 0.78755075185068701, 0.7605384231262089, 0.7461119425562226, 0.77474140091897714, 0.78621451407986276], [0.76496255134698599, 0.74420764816633478, 0.76131677234053963, 0.76380128224902355, 0.76426174628415744, 0.7556994345867577, 0.76639633218401593, 0.78865527620937936, 0.77143394466927673, 0.78662050667044392], [0.77233112680802507, 0.7707939510570474, 0.76468390400146269, 0.77718179037570234, 0.76715349425863399, 0.75411044605894317, 0.77171666337323364, 0.75587731024967875, 0.76888050874970804, 0.74324358730657802], [0.75230449803589317, 0.76425019917535875, 0.7594680210134408, 0.75570678865923102, 0.75527548601961347, 0.75988084364100184, 0.7442198776468929, 0.75341591940905905, 0.76334799776923135, 0.76269501022598274], [0.76171770700445796, 0.74879581600480483, 0.74341203322836136, 0.75940853513227213, 0.75320960765003686, 0.74570297278325792, 0.75215936831619712, 0.7601773437606878, 0.77388253686256714, 0.76005918915146531], [0.75551271489481331, 0.75361039296696064, 0.7437329419354054, 0.75342423909068912, 0.75446057801780619, 0.75322803146405404, 0.74515455383659635, 0.74504890651010969, 0.75027193650000035, 0.7507942025164962], [0.74612492060178348, 0.73350302710297854, 0.75069517301240862, 0.73258960440385146, 0.74448268944866969, 0.73723754875991943, 0.75022124103878485, 0.74370803750386516, 0.73066250236026364, 0.74321665504306356], [0.72822868567007237, 0.73758556570105238, 0.73378159290564415, 0.73879602404029809, 0.73223626717491097, 0.73720372979240423, 0.73397396721057617, 0.73348960376861094, 0.73180409826496551, 0.7338948367804532], [0.73021951586101563, 0.71766049752279482, 0.7185353986360915, 0.72074323656237282, 0.71874308078915172, 0.7184598417474376, 0.71805779214177101, 0.73269551744302552, 0.72542842876752545, 0.72892718473810247], [0.71603617016968724, 0.72405592711795164, 0.71677295008700226, 0.70693145150066261, 0.71285759473431853, 0.70812982640779054, 0.7079887403195031, 0.7123777123674917, 0.71302446994431068, 0.72212097597834235], [0.70006376536728032, 0.67929161181227804, 0.70134848737315902, 0.6867790467151057, 0.68000023635116735, 0.70033058133606152, 0.69511972739435035, 0.6837599587549702, 0.6863299436080843, 0.68087626819734204], [0.67711051836399105, 0.66607613447126224, 0.67304473478184801, 0.67976118624770521, 0.66460142294545643, 0.67065974529707173, 0.66083810307959445, 0.66846106566106356, 0.66240057682203846, 0.67501117637551544], [0.65306995219664954, 0.63182597878439306, 0.63657096549245984, 0.65771020223449794, 0.62913174895304957, 0.63272481876287112, 0.63712119751600371, 0.65082171760271357, 0.6516713055838691, 0.64915606869247233]]} 
average_performances = {'R^2': [0.5861784528604019, 0.5874751397787072, 0.5837824471484417, 0.5720530754561295, 0.5704054880881138, 0.561996812075057, 0.5477174175732745, 0.5366484632103689, 0.5187470626867816, 0.5044115316748744, 0.4655762540679687, 0.4316404403482654, 0.37896553849685727], 'MSE': [0.082069559461790037, 0.082351274726184601, 0.083159195937083097, 0.085120083917056916, 0.085697815629918295, 0.08734894367879284, 0.090138450068484754, 0.092539904499413711, 0.096062892153507301, 0.098777545078180484, 0.10658084075644325, 0.11335760213977468, 0.12382177511380665], 'Rp': [0.76647935478862217, 0.76673554947069156, 0.76459727822390133, 0.75705646415957051, 0.75585251098941086, 0.75052384977329312, 0.74124413992755889, 0.73409943713089876, 0.72294704942092891, 0.71402958186270604, 0.68938996269097974, 0.6697964664045547, 0.64298039558189801]}

1000 iterations
repeats=10 
fractions_unknown = [0.3, 0.35, 0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75, 0.8, 0.85, 0.9] 
all_performances = {'R^2': [[0.5923533943294081, 0.5991350843196055, 0.6007044498912247, 0.5744902174090325, 0.5501470878750272, 0.6186899830827047, 0.5820741952740597, 0.5565382957700464, 0.592445919147702, 0.6102212540751321], [0.5843584200471561, 0.5577209747229808, 0.5867989811984127, 0.5880021347153404, 0.5870678143732664, 0.5741903317303563, 0.5942733956215251, 0.6213643257799004, 0.6032580528387865, 0.6237180650482266], [0.5982749104309668, 0.6030913585516778, 0.5840712914869829, 0.611932135248803, 0.5952274456558648, 0.5725260293272678, 0.6011691992800176, 0.5729982350891835, 0.600374624877186, 0.557317627952185], [0.5719512931666189, 0.5884006829657022, 0.5851269371092542, 0.5765511168285826, 0.58231337582395, 0.5847597607117514, 0.5561614199833786, 0.5932868088607928, 0.5914669907387123, 0.5867235882178172], [0.5831027017288415, 0.56227589016256, 0.5568972815663149, 0.5869045476656923, 0.5765204541670509, 0.5629303559448242, 0.5797881630253932, 0.5807442736203889, 0.6062434442158906, 0.5857398024770943], [0.5805980010079161, 0.575207716305278, 0.5605719374054928, 0.5780837095027225, 0.5775776592156647, 0.5765878771950708, 0.5631313974080776, 0.5570709572597301, 0.5708044056153928, 0.566630256868627], [0.5658801441299577, 0.5551078793712377, 0.5681087323911298, 0.5517856961448194, 0.5543975658172542, 0.553179178667723, 0.5642047283299937, 0.5571100141228819, 0.540731518648598, 0.5622544836669048], [0.5491022290555071, 0.5525235753375504, 0.5449311684398249, 0.5587562654876947, 0.5470959428284891, 0.5584695000498993, 0.5438336271217057, 0.5527372596151212, 0.5434879943994753, 0.5452329142742753], [0.5360160971503218, 0.525707115705761, 0.5350982402990041, 0.5356828205948614, 0.5256106136094455, 0.5270553724185051, 0.524102670805259, 0.5429055514040031, 0.5371084505738861, 0.5431299134532274], [0.5289388446547849, 0.5336832860000369, 0.5189149004869333, 0.5149555246051865, 0.5116249439284463, 0.5070004243344017, 0.5198758476400127, 0.5190006730196616, 0.5011354537737912, 0.5289367962401653], [0.5015513776943872, 0.4716554627523245, 0.4961481781612942, 0.47355336027117734, 0.4809833940847442, 0.5000891774682077, 0.49197597287519645, 0.4895150790084094, 0.4989098407917405, 0.48014273522670126], [0.4840496017388276, 0.4326627484792339, 0.4494322967868375, 0.4584426795053915, 0.4465913505184592, 0.43959519010410697, 0.452278324729367, 0.46009668986368224, 0.43501290003661597, 0.4646169973079257], [0.4150869435002872, 0.3886654496639256, 0.39577072562226356, 0.4297009623319413, 0.3996643743582582, 0.4149680253058745, 0.400194075326325, 0.4517814299376899, 0.43729084905343696, 0.41118087150880533]], 'MSE': [[0.079852955138879259, 0.077583342029887481, 0.079429044433077398, 0.084360745128334413, 0.088955078075032806, 0.078243627202713911, 0.08337055361792442, 0.088748248776385083, 0.081278914580119932, 0.075914180679865981], [0.082435052016522792, 0.088934336591130717, 0.08261468376359879, 0.082825602427057027, 0.082708147913414562, 0.084539590904184406, 0.080864854369369077, 0.075245095521150385, 0.079411260286265814, 0.074741305445452086], [0.079800380362817322, 0.080651827664149023, 0.082695575967092455, 0.077034467764080988, 0.080780413206896995, 0.086636296709816207, 0.079684084464330993, 0.085234357329332752, 0.079769900605707572, 0.087475651904022261], [0.085861279838203228, 0.081923651709015458, 0.081996024750021698, 0.084787531619543263, 0.082703300655419296, 0.082471075741396574, 0.088075190044350493, 0.081219175131566304, 0.081081114768018367, 0.081937478234228145], [0.083504792603751654, 0.087611641036174623, 0.088469202424206222, 0.082686103895069266, 0.084366672051032862, 0.086674377673125039, 0.083558241627593649, 0.083809751327974025, 0.078210102710325247, 0.082720332523067389], [0.083522404250670659, 0.084664387785429701, 0.087777129760010772, 0.084583991273628062, 0.084170229986160847, 0.084944985032483961, 0.086492566082615144, 0.088489130897835444, 0.085675093388231954, 0.08595157246437847], [0.08670381837884196, 0.088404202870043747, 0.085907322333217406, 0.089129394535096593, 0.088689323406974038, 0.089487626336856849, 0.086953361932284243, 0.088088201340352515, 0.091972164360700381, 0.087005280847561192], [0.089938938473728011, 0.089561447436814226, 0.090657413350212449, 0.088397671514995849, 0.090199966684167646, 0.08807871892115815, 0.090824570723455761, 0.089604238049623766, 0.09136517899374158, 0.090868291407722762], [0.092338394722583844, 0.095289260451038207, 0.09275556485476566, 0.092967423451018549, 0.094674879205182291, 0.094289330659766676, 0.094468362105267364, 0.091360495828063354, 0.092710809130389815, 0.090837272076216766], [0.094319032647660991, 0.093137361130895491, 0.095730022372735049, 0.096751269407151078, 0.09719198280122876, 0.097585233603922655, 0.095698222505585351, 0.096035036402492807, 0.099644981727596796, 0.093783889943289483], [0.099315494565916471, 0.10528589671824491, 0.10043642253770242, 0.10506384182192544, 0.10340991848918447, 0.099464647890002464, 0.10156281869918748, 0.10172580448388654, 0.09995069035052373, 0.10397237881685086], [0.10306081327964041, 0.11336705996138068, 0.10947537530118041, 0.10786606217041005, 0.11016129801269951, 0.11170981352740612, 0.10932473199262316, 0.10779876813179515, 0.11274653701401414, 0.10689531600552432], [0.11663413558762122, 0.12174674472217376, 0.12032969994450937, 0.11359717722737113, 0.11976947078209615, 0.11675686518234596, 0.11973050465201732, 0.10937041126672135, 0.11225769638622908, 0.11730252148340431]], 'Rp': [[0.76978818999819942, 0.77418322299977649, 0.77512000934701486, 0.75824463203399994, 0.74612936676431174, 0.78682627886802581, 0.76441821017553047, 0.7470059190320224, 0.77203795875798231, 0.78135134075136958], [0.76474205576364407, 0.74721527739896154, 0.76622351022162871, 0.76699802956663143, 0.76625127176749408, 0.75882806754243237, 0.77091007200076656, 0.78920942816202655, 0.77675031750472878, 0.78981480432890605], [0.77422917968603322, 0.77676953903346546, 0.76546693907398511, 0.78261267704885784, 0.77168655608717396, 0.75715843764408775, 0.77545933944388556, 0.7572798571261049, 0.7756154980479335, 0.7477675770679304], [0.75660548028061791, 0.76758434809676879, 0.76587767123507156, 0.76009843635278351, 0.76367440463408975, 0.76481270707151872, 0.74660825896239913, 0.77124563296908055, 0.7691954705012698, 0.76611652797066865], [0.76441583784042355, 0.750932108450866, 0.74680254058915163, 0.76614090320645434, 0.76026410934947553, 0.75071729221909289, 0.76177200748695284, 0.76249402819933487, 0.77893372874086741, 0.76542678088324789], [0.76213286556481408, 0.75909129240504747, 0.74917061454460265, 0.76046059571736657, 0.76073900084542478, 0.76016347222171043, 0.75118220932124458, 0.7469941554069095, 0.75763291623944218, 0.75301962564125402], [0.75265056720158108, 0.74592561555851999, 0.75468733106531394, 0.74350405277597387, 0.7467011937434036, 0.74396887697459713, 0.75164164334504535, 0.74726927401446719, 0.73719475752002894, 0.7504683348430965], [0.74181541796304884, 0.74405963054750113, 0.73916294461731724, 0.74779927999884821, 0.74066837963424803, 0.74849513661424705, 0.73933806982543016, 0.7439066615316221, 0.73799781983427637, 0.73935311909117829], [0.73551762941742471, 0.72632605611831114, 0.73226013065303519, 0.73283704081901935, 0.72709722990795855, 0.72698186105774187, 0.7265171854800988, 0.73764160037607884, 0.73417085597847365, 0.73749633088253796], [0.72807375058215651, 0.73240494428804737, 0.72105277431038084, 0.72169650680681274, 0.71880505465620292, 0.71634423473219633, 0.72268765963910775, 0.72181570615749258, 0.71208716436466712, 0.72840023745625249], [0.7121358264919494, 0.69141912079910095, 0.70827945201841525, 0.69561110810939719, 0.69693750711151181, 0.71105115244602457, 0.70359899992735819, 0.70299447946037219, 0.70800257960340751, 0.69609156763467273], [0.7011077562079765, 0.67117224960623878, 0.68112015246844215, 0.68490883826420601, 0.68118868817967815, 0.67473072239543097, 0.67994682139467499, 0.68354169493301153, 0.67249602304764866, 0.68679050108907247], [0.66509722088394363, 0.64905893855434382, 0.6545135485967537, 0.67042849395764947, 0.65313568766361918, 0.65924106679421379, 0.65419563038120332, 0.67678802544474737, 0.67205575810274776, 0.66337126615297015]]} 
average_performances = {'R^2': [0.5876799881173943, 0.5920752496075952, 0.5896982857900135, 0.581674197440656, 0.578114691457405, 0.5706263917783972, 0.55727599412905, 0.5496170476609543, 0.5332416846014273, 0.518406669468342, 0.4884524578334183, 0.45227787790704477, 0.4144303706608807], 'MSE': [0.081773668966222082, 0.081431992923814561, 0.081976295597824655, 0.083205582249176291, 0.084161121787232007, 0.0856271490921445, 0.088234069634192891, 0.089949643555562037, 0.09316917924842924, 0.095987703254255846, 0.10201879143734247, 0.1092405775396674, 0.11674952272344896], 'Rp': [0.76751051287282324, 0.7696942834257221, 0.7684045600259457, 0.76318189380742674, 0.76078993369658665, 0.75605867479078159, 0.74740116470420281, 0.74225964596577165, 0.731684592069068, 0.72233680329933159, 0.70261217936022091, 0.68170034475863805, 0.66178856365321936]}

repeats=20 
fractions_unknown = [0.3, 0.35, 0.4, 0.45, 0.5, 0.55, 0.6, 0.65, 0.7, 0.75, 0.8, 0.85, 0.9] 
all_performances = {'R^2': [[0.5574430075902507, 0.6149981108848097, 0.6229195262510814, 0.5981429577501557, 0.6054772790277886, 0.6085433427027704, 0.5758269458994824, 0.6411636910251435, 0.6146052551526211, 0.6083669902060764, 0.536663909093593, 0.6120335452147574, 0.5756356512245705, 0.6080162742236693, 0.6251531828804988, 0.6459395892771955, 0.5942477202696212, 0.6274178898205016, 0.5999711936398562, 0.5797072803657835], [0.595388916347054, 0.5677837076221599, 0.6032063574319846, 0.6114966830584714, 0.5816098902782689, 0.6046369078877893, 0.5861419043431948, 0.5810272558829893, 0.5762502167875656, 0.5971611620575352, 0.5930211115072301, 0.5981095448039666, 0.5757436459496328, 0.5909137085933308, 0.591820343536463, 0.590997982852588, 0.6064967539195375, 0.5682014073158261, 0.5700870449230555, 0.5620905561476859], [0.6022201578136919, 0.6037067310857485, 0.6122005832552493, 0.5917527137511689, 0.5897524505759706, 0.5738090598940828, 0.5859161908383387, 0.5720895793974612, 0.5933441095816616, 0.5980685551018317, 0.58377604016598, 0.5847688633447781, 0.5936204511838894, 0.5898674370831405, 0.5909506826665949, 0.5967571551833227, 0.5968010805589907, 0.5975257961388455, 0.6028119980076201, 0.5851903260339408], [0.5856189297913408, 0.5748851241781515, 0.5661300034476349, 0.5964627408186558, 0.5958929432088724, 0.5832411059856756, 0.577181188981793, 0.5780552384337059, 0.5824041613554043, 0.5956104353975014, 0.6025325543823123, 0.5827302037171602, 0.5885484873789365, 0.5623389388665214, 0.5968012563528918, 0.5937702556870259, 0.5700291636325795, 0.5946461067247715, 0.5622699294205626, 0.5772757160858171], [0.5640107454628444, 0.5698203589998505, 0.5766682523874893, 0.5659672069347338, 0.5867385919910472, 0.5681860606474352, 0.5643428452294029, 0.5718089728544486, 0.5737165362981689, 0.5737445700000248, 0.5897044514699917, 0.5873755803030127, 0.5754501189810028, 0.5739369341725897, 0.581685676371916, 0.5644688942861675, 0.5756624981073295, 0.5764433336351569, 0.5682882208203048, 0.5783265079102167], [0.5587831037490419, 0.5557980084914647, 0.5613994206421486, 0.5696467885915422, 0.5669638387497555, 0.5627856754962062, 0.5662280498786023, 0.5680019369031974, 0.5830379016114646, 0.5830230387529087, 0.5786678856373642, 0.5790773419737816, 0.5540603881829705, 0.5844124476362214, 0.5788348438867728, 0.5676147008604314, 0.5862736603910828, 0.575017206730668, 0.5751398081486263, 0.5654515616255659], [0.5436193520250139, 0.5566022255825158, 0.5668106516060122, 0.5580173886592965, 0.548856815266867, 0.5656158387903212, 0.5520586769180076, 0.572574275353405, 0.5545654980428079, 0.5582651196536932, 0.5597818454897423, 0.5572083981174927, 0.5548382255160245, 0.5568590254772309, 0.570215625624019, 0.5475447448547608, 0.5410720518965837, 0.561113488815328, 0.5558583804126409, 0.5713779585345139], [0.5555605071107976, 0.541870415802264, 0.5532409183915282, 0.5507576299929325, 0.5606244458790912, 0.542423577828431, 0.5432205490865198, 0.5489381250468974, 0.5561009654553081, 0.5566858522493133, 0.5473095786689754, 0.5520726243536171, 0.5483947470363817, 0.5314717579355359, 0.5485201751931177, 0.5293357728045847, 0.5574226324372396, 0.5450932901064471, 0.5518065368698087, 0.558923678563989], [0.5139586955544835, 0.5085594024114112, 0.5283254025361119, 0.5401594526356823, 0.5349420834420247, 0.5337111169946087, 0.5227899366360573, 0.5490124947354121, 0.5423776772122397, 0.524269188138992, 0.5353991167121623, 0.5356952625715982, 0.5311044396421356, 0.5382822652403838, 0.5150001125005246, 0.5505711208788887, 0.5359776522612993, 0.5329360229920528, 0.5443618684796239, 0.5411498081669913], [0.5037222341988858, 0.5218336652764757, 0.5360217619708072, 0.527100549228844, 0.5265940024348612, 0.49786451994845193, 0.5294613519078767, 0.5255618384912328, 0.5300181481819233, 0.525866720864947, 0.5027391691828933, 0.5001166313855863, 0.5249436061237356, 0.5324995210616618, 0.5064192630967808, 0.5172127401617754, 0.5135333411412304, 0.5068595125613102, 0.5085615608594616, 0.5149672369915035], [0.48498704125994685, 0.48780450691793886, 0.4730260662640031, 0.49227399641386527, 0.4881213661960101, 0.49920939872812087, 0.4816593026048439, 0.46150165975301694, 0.49491027621631434, 0.48311659280093855, 0.4792301844246324, 0.5080934785690483, 0.46347920815160115, 0.49327901340585256, 0.47428008964385726, 0.5011577722099677, 0.5139907713156688, 0.4971104539714034, 0.5033723526410046, 0.4816924840071367], [0.4831132679402469, 0.4768155991717353, 0.4274170326685154, 0.4689165805737321, 0.4689859688595076, 0.4688466863410038, 0.46997576140600983, 0.44106633011984164, 0.4732556078031225, 0.4642163492698502, 0.459170579719984, 0.4720806869962101, 0.47096457159491867, 0.45737055903514634, 0.4598974603608831, 0.4615138753882465, 0.4639176631435096, 0.4477950198063938, 0.45112841520945124, 0.47779402293146533], [0.4105263288379344, 0.4130987225009626, 0.4038137573112852, 0.4011831054285312, 0.3885972338413982, 0.4153734863886639, 0.4087521137039122, 0.4285346439211766, 0.4276106056027583, 0.3658179345306396, 0.4205350109335494, 0.4033100130560565, 0.42340970119204224, 0.41100839060158734, 0.4079571124760294, 0.39258384391925116, 0.4125868290978081, 0.423326944273441, 0.39241523842123294, 0.39523567061719045]], 'MSE': [[0.08626749345675154, 0.077387862061961049, 0.074272295105063793, 0.079919155618035503, 0.077167257347497645, 0.077844519611036375, 0.083794142118568921, 0.072916479160661588, 0.076590397150746128, 0.076530297247107179, 0.09228454654968922, 0.078148288976579078, 0.085843489112303148, 0.076917895685352483, 0.075380541213066921, 0.068318168783714467, 0.079759714815650459, 0.075390277595600172, 0.082242935742425402, 0.083093785617802049], [0.081165333084100955, 0.086226261863103712, 0.079398369234222804, 0.076406257454651738, 0.083264187803756926, 0.07897701952421167, 0.08201151051077786, 0.083174623215905005, 0.084439870827076394, 0.079880614532601896, 0.080452013230890032, 0.080320251369739179, 0.085073517355601924, 0.081029283788747478, 0.080362140801112966, 0.080754453321648087, 0.078806272618620651, 0.084628843559847622, 0.08520299403357888, 0.086335750794878027], [0.079660710936541645, 0.078741416572447154, 0.077336570847451575, 0.08239985746717772, 0.081740742201417346, 0.08470271984137609, 0.0827498493928331, 0.084806992613003174, 0.081139709636313076, 0.080990656953929804, 0.082610594353746222, 0.083930691147379957, 0.081840370067213203, 0.081700466663235161, 0.081875672780190437, 0.080317293444870305, 0.079910444941922745, 0.081117086398264551, 0.079644705287298473, 0.082497792294645031], [0.082037750605625889, 0.084625672486131343, 0.086831065461004373, 0.080039256552424429, 0.080505979769862041, 0.083383697358808712, 0.084374342872851935, 0.083882105098591814, 0.082624514678522845, 0.080926495968002388, 0.078780493908255547, 0.082819873241852915, 0.081895763727485166, 0.086831641127760692, 0.080335487722401011, 0.081427226029078509, 0.085426726504417891, 0.080896481547792318, 0.086993148437641624, 0.084317191745597583], [0.08629903036191916, 0.085812871183437112, 0.083767254372673003, 0.0861725977319273, 0.081810085377021863, 0.086453068272442091, 0.086029000087765706, 0.085754976374231157, 0.084902604229051243, 0.084801416025509585, 0.081594317445231435, 0.082378260239013651, 0.085004886106314556, 0.085033306169868081, 0.083876535500989349, 0.087112754839006198, 0.084061306570940422, 0.084655533256846785, 0.086140801982057466, 0.084517177200180191], [0.087722498961340989, 0.088922743082306202, 0.086647891673205621, 0.086116357506374017, 0.08666154746219977, 0.08684135177244999, 0.086713061380958523, 0.086412209591393868, 0.082942765248616421, 0.083284020598056813, 0.084311778139316104, 0.083623703696799057, 0.088412915558796823, 0.083206240149878027, 0.084358045321520761, 0.085858667936310501, 0.082039407647269816, 0.085370065195314246, 0.08469883825857992, 0.086320380331573063], [0.090442423613518619, 0.088181823265279458, 0.086331492016111053, 0.087676500985923125, 0.089630129213949403, 0.087073809822597367, 0.088835151834059656, 0.085287143720724698, 0.088409974297982238, 0.088084464847980423, 0.088321083071389847, 0.087979067176448197, 0.088675371526595589, 0.088194011963103752, 0.085982958837604567, 0.089688728860880487, 0.091106433955007171, 0.087780693511306823, 0.088205991305354225, 0.085326345746403881], [0.088774891533840813, 0.091255260551599535, 0.088559765663985129, 0.089656169572386341, 0.087889219333485161, 0.090880491906688496, 0.091702036262430009, 0.089895493083426634, 0.088293130574175607, 0.088593506388748466, 0.090319971821940875, 0.089337944362018071, 0.090225720928737457, 0.093414347330655498, 0.089813199363959192, 0.093847827020181712, 0.08855208327855045, 0.09076859194369806, 0.089499496404175538, 0.087891328907275301], [0.096500277284980451, 0.098655589866311108, 0.094470410556275461, 0.09211785493323664, 0.092536576773152981, 0.092887156281847405, 0.094850273317208342, 0.089955575699765214, 0.091415094630764568, 0.094820907863599271, 0.092798484366252418, 0.092254754988046653, 0.093497551171270218, 0.092161138734121587, 0.096935915981384166, 0.089864331801029429, 0.092575614970836995, 0.093466015772149511, 0.090802793518701908, 0.091403752853695078], [0.098740062025078179, 0.095059549340308469, 0.092854657979946534, 0.094216237454500473, 0.094686898870027139, 0.10026778555918915, 0.093920025306681559, 0.094737388001113934, 0.094118466239353382, 0.094573064900827716, 0.099015841585453943, 0.099920359043652707, 0.094943248604259331, 0.092981877867492277, 0.098293240967427767, 0.096362282045374989, 0.097202544475805244, 0.098078460732447692, 0.09768726838968031, 0.096552825805684486], [0.10279359806373346, 0.1018708034962762, 0.10502488305026657, 0.10102493854516809, 0.1020856558365848, 0.099743130543890612, 0.1031848596526285, 0.10754965830771833, 0.1003516168344869, 0.10318879830740874, 0.1040364713158909, 0.09818155290502828, 0.10730899542728567, 0.10096964494458191, 0.1047085692880652, 0.099195127567923883, 0.09731488470957822, 0.10007318306261902, 0.098651510150348481, 0.10332894759029343], [0.10299122148786609, 0.10408886559490506, 0.11433871493952259, 0.10605491958940742, 0.10619319788258341, 0.10621280971774059, 0.1059015618623747, 0.11137020415880791, 0.10522597914050541, 0.10654129485625675, 0.10792002430408554, 0.10541071082932353, 0.1055042552961222, 0.10824834385392018, 0.10759148844803119, 0.10742802654812003, 0.10699548024866283, 0.11006450774376382, 0.10958769726347967, 0.1042718916834707], [0.11728541147301418, 0.11718670052311295, 0.11884761199747271, 0.11931622283335142, 0.12182460405700635, 0.11674218514724345, 0.11776348265643113, 0.1141169049118317, 0.11408093833617815, 0.12631612808018436, 0.11550509951068182, 0.11912294402374929, 0.11508589916318668, 0.11759680058029343, 0.11826988538897759, 0.12179427881326199, 0.11701758966456455, 0.11501281880045097, 0.12073857641375059, 0.12076796116021146]], 'Rp': [[0.74981587917313142, 0.78425006315342227, 0.78936930540447214, 0.77470294605183798, 0.77830326735521527, 0.78018141916241712, 0.759067729739903, 0.80135615737217347, 0.78418480700274895, 0.78042681951390902, 0.73421510070200025, 0.78265021046047001, 0.75960109046001922, 0.77977692671503251, 0.79194726270643834, 0.80543547921718539, 0.77373512832328084, 0.792358259523115, 0.77467638313910292, 0.7614534751401294], [0.77211620829675742, 0.75351885424342535, 0.77741546479825363, 0.78220414299816732, 0.76336745334476031, 0.77791511300503513, 0.7656440303498141, 0.76302488853223827, 0.76028104255323914, 0.77307662333089444, 0.77040383063632922, 0.77352044160870814, 0.75886737818805139, 0.76966386055419134, 0.76934475586719953, 0.76978958464519431, 0.77949619212872778, 0.75551085076382241, 0.75565500267915175, 0.75036955533670513], [0.77611561521495709, 0.77759216701016542, 0.78252975071284692, 0.76962825276476809, 0.76958802052367015, 0.75803274909315954, 0.76608694860500848, 0.75746937442966611, 0.77044849320231945, 0.77338466111577908, 0.76431830635625997, 0.76471442659184208, 0.77052981627750183, 0.7681486748416424, 0.76909099536938275, 0.77304431403522944, 0.77267775858760213, 0.77313521765072468, 0.77653198923483036, 0.76501039730250098], [0.76543410629724484, 0.758482896693633, 0.75274307693804998, 0.7731195640053713, 0.77284956515592484, 0.76408866997439262, 0.76011093957204856, 0.76074654623899174, 0.76399134918869005, 0.77219580325135129, 0.77657167006210104, 0.76381683995707905, 0.76730824952166821, 0.75036768422469668, 0.77265265064312549, 0.77081026363465477, 0.7558394078168823, 0.77113973600596342, 0.75153157551410577, 0.76003936155790042], [0.7518833679117497, 0.75513344316443343, 0.76002119117892808, 0.75306142403353837, 0.7667651411501567, 0.75395283562774351, 0.75233799686880731, 0.7563768518131474, 0.75755976617430554, 0.75776105328406307, 0.76802076337236003, 0.76645768178798168, 0.75869329770632599, 0.75775590075352062, 0.76287469582818868, 0.7518308501299753, 0.7589241851038192, 0.75939295024663511, 0.75408725257669118, 0.76060823758525797], [0.74854193943548031, 0.74600991354972701, 0.75094325966229314, 0.75477653759128716, 0.75361974447033686, 0.7508691714841228, 0.7531760122833272, 0.75420444531374431, 0.7637144962788015, 0.76360796027341582, 0.76102534274176314, 0.76164465991644303, 0.74536726510873097, 0.76472507000741241, 0.76105803995160326, 0.75372404526960435, 0.7659883133243427, 0.75834461230638139, 0.7588694182665916, 0.75293585712835243], [0.73807801787267024, 0.74669345061195147, 0.75351209937830399, 0.74761453956873014, 0.74174912836778417, 0.75263923358078921, 0.74367081202056318, 0.75711525672863667, 0.7455507122245939, 0.74781679604836537, 0.74883428898586968, 0.74725083680795235, 0.74543415197723573, 0.74723004576498853, 0.75541970308016082, 0.74102793912982123, 0.73754059070081501, 0.74918020343139502, 0.74646707287088487, 0.75594845286575374], [0.74660185789578359, 0.73804222700223987, 0.74462212057089594, 0.74297421396737373, 0.74929050318912838, 0.73813949705783533, 0.73750517966680151, 0.74107556013867637, 0.74627603581856061, 0.74631650310903797, 0.7402335213459712, 0.74378263708655312, 0.7411063101573675, 0.73074976308634698, 0.74143387038989295, 0.72873681014340086, 0.74765246057136414, 0.7391150232861009, 0.7430604958055228, 0.74877647762703869], [0.71904680219185246, 0.71606177537414295, 0.72775153324203767, 0.73600720396615948, 0.73297035037173797, 0.73194238713254434, 0.7255221377887453, 0.74152971296464576, 0.73730847265526378, 0.72581468848104702, 0.73278553687287173, 0.73257355100810484, 0.73001912274118885, 0.73477659497632353, 0.72003395745109289, 0.7429361419738415, 0.73403019730542374, 0.73094496812287513, 0.73799025650101857, 0.73627309745411673], [0.71396498981095757, 0.72464206660292518, 0.73370035181987769, 0.72814704470426705, 0.72611915443265806, 0.70912542358179231, 0.72889624408316767, 0.72574844161580454, 0.72917754004571622, 0.72619866114396725, 0.71391535448693588, 0.70980532159865029, 0.72545550547037008, 0.73194891311485188, 0.71325494424615599, 0.72051714896791819, 0.71837992748205559, 0.71532108700877572, 0.71626985727578851, 0.72089785561142705], [0.70103565797223666, 0.70311717523704964, 0.6954576604345426, 0.70465729237222097, 0.70369856854935009, 0.71107652136748822, 0.69939689959951978, 0.68546773688378271, 0.70742293505968545, 0.69876862136112161, 0.69782164230644961, 0.71506863470086246, 0.68724892993390585, 0.70689301730948551, 0.69613680333526651, 0.71061688112797294, 0.71815777259418656, 0.70725232987544595, 0.71422817853118936, 0.70034336833272315], [0.69884546146758331, 0.69587668572856576, 0.66701622784224324, 0.69010271568764125, 0.69005464309988673, 0.69155736412942037, 0.6922921002818424, 0.67644103343403206, 0.69444261147068442, 0.6903165516607821, 0.68695042015872632, 0.69461167910788224, 0.69415813200142917, 0.68191671330677373, 0.68500569838963077, 0.69019505655930524, 0.68724478078784135, 0.68099550950752685, 0.68284087469211308, 0.69487948685210266], [0.65569515203181106, 0.65967861886789192, 0.65761563316999427, 0.65939353500044395, 0.64821885372932131, 0.66312387043542931, 0.65785140233568806, 0.66478422412027904, 0.67161538276418109, 0.64065391213780576, 0.66390038480068925, 0.65677702029070506, 0.66482623691451859, 0.66014991416905155, 0.65977754139776357, 0.64660394998383142, 0.66230090630768601, 0.66643904833136469, 0.65300287129809265, 0.65285951571737599]]} 
average_performances = {'R^2': [0.6026136671250113, 0.5876092550623165, 0.5922464980831152, 0.5833212241923657, 0.5743173178431566, 0.5710108803969909, 0.5576427793318139, 0.548988689040639, 0.5329291559871343, 0.5175948687535123, 0.4881148007747586, 0.4632121019169887, 0.40728383433277254], 'MSE': [0.079003477148480633, 0.081895478446253694, 0.081485717192062837, 0.082947745742205453, 0.084808889166321344, 0.085523224475613016, 0.088060679978611028, 0.089958523811597912, 0.093198503568231464, 0.096210604259715254, 0.10202934147998885, 0.10709705977244748, 0.11821960217674773], 'Rp': [0.77687538551580027, 0.76705926369303334, 0.76990389644599289, 0.76419199781269387, 0.75817494431488142, 0.75615730521818814, 0.74743866660086333, 0.74177455339579468, 0.73131592442875171, 0.72157429165520326, 0.70319333134422435, 0.68828718730830063, 0.65826339869019623]}
'''